---
// Imports
// import '../../styles/pages/[about, contact].scss'
import '../../styles/pages/post.scss'

import Layout from '../../layouts/Layout.astro'
import { findPostById, getPosts } from '../../lib/getPosts'
import { extractSlugFromFilePath } from '../../lib/getPosts'

// Helper functions
// Helper function to get author information
function getAuthorInfo(authors: any, authorUsername: string) {
    return authors[authorUsername as keyof typeof authors]
}

// Static path generation
// Dynamically generate static paths from published posts
export function getStaticPaths() {
    const posts = getPosts()
    return posts.map(post => ({
        params: { id: extractSlugFromFilePath(post.file) }
    }))
}

// Data loading and processing
// Get post ID from URL parameters
const { id: postId } = Astro.params;

// Load authors
import authors from '../../lib/authors'

// Find the specific post
const currentPost = findPostById(postId);

if (!currentPost) {
    throw new Error(`Post with id '${postId}' not found`);
}

// Get author information
const authorUsername = currentPost.frontmatter.author;
const authorInfo = getAuthorInfo(authors, authorUsername || '');

---

<!-- Individual Post Page -->
<Layout title={currentPost.frontmatter.title} pageType="post" author={authorInfo.displayName} classItems="ignorePadding">
    <section class="info">
        <a href={`/author/${authorUsername}`} class="author">{authorInfo.displayName}</a> | <span class="date">{currentPost.frontmatter.date}</span>
    </section>
    <section class="post-area">
        <div class="scroll-percentage"></div>
        <article class="post-content" set:html={currentPost.compiledContent?.() || ''}></article>
        <section class="giscus" />
        <script 
            src="https://giscus.app/client.js"
            data-repo="adarshrkumar/blog-comments"
            data-repo-id="R_kgDOONF60Q"
            data-category="Announcements"
            data-category-id="DIC_kwDOONF60c4CoXN1"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="preferred_color_scheme"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
        </script>
    </section>
</Layout>