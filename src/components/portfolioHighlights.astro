---
import '../styles/pages/portfolio.scss'

import SiteGridContent from './siteGridContent.astro'
import getFName from '../../content/getFName'
import sanitizeMD from '../lib/sanitizeMD'
import type { PortfolioItem } from '../lib/types'

var highlights = ['TransTrack', 'graphics-for-good', 'SMCAS']
const ports = import.meta.glob('../../content/work/portfolio/**/*.md', { eager: true })
const keys = Object.keys(ports)
const allItems = Object.values(ports) as PortfolioItem[];

var items: PortfolioItem[] = []

highlights.forEach(name => {
    // Add .md extension if not already present
    const filename = name.endsWith('.md') ? name : `${name}.md`
    var res = allItems.filter(item => getFName(item.file) === filename)
    if (res) {
        if (res.length > 0) {
            res.forEach(r => items.push(r))
        }
    }
});
---
<SiteGridContent classItems="portfolio wrap">
    {
        items.map((item, i2) => {
            var target = '_blank'
            var url = item.frontmatter.url
            if (url.startsWith('//')) url = `https:${url}`

            var domain = url
            if (domain.includes('://')) {
                domain = domain.split('://')[1]
                if (domain.includes('/')) domain = domain.split('/')[0]
                if (domain.startsWith('www.')) domain = domain.slice('www.'.length)
                domain = `https://${domain}`
            }
            
            if (!url.includes(':') || domain === Astro.site?.toString()) target = '_self'

            var imageSize = 512
            var image_url = `https://webshot.adarshrkumar.dev/take?url=${encodeURIComponent(url)}&viewport_width=${imageSize}&viewport_height=${imageSize}`
            return (
                <a href={url} target={target} class="item">
                    <img src={image_url} alt="" class="item__img" style={`--placeholder: url('${image_url}&image_quality=${50}')`} />
                    <div class="item__info">
                        <h3 class="item__title">{item.frontmatter.name}</h3>
                        <p class="item__content">{sanitizeMD(item.rawContent())}</p>
                    </div>
                </a>
            )
        })
    }
</SiteGridContent>